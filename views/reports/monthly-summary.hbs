<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">
        <i class="bi bi-calendar-month"></i> Monthly Summary Report
    </h1>
    <div>
        <a href="/reports" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Reports
        </a>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">Total Hours Allocated</h6>
                        <h3 class="mb-0">{{totalAllocatedHours}}</h3>
                    </div>
                    <div>
                        <i class="bi bi-clock display-4"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">Hours Delivered</h6>
                        <h3 class="mb-0">{{totalHoursDelivered}}</h3>
                    </div>
                    <div>
                        <i class="bi bi-check-circle display-4"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">Utilization Rate</h6>
                        <h3 class="mb-0">{{utilizationRate}}%</h3>
                    </div>
                    <div>
                        <i class="bi bi-percent display-4"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">Total Sessions</h6>
                        <h3 class="mb-0">{{totalSessions}}</h3>
                    </div>
                    <div>
                        <i class="bi bi-calendar-event display-4"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Resident Summary</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Resident</th>
                                <th>Property</th>
                                <th>Allocated</th>
                                <th>Used</th>
                                <th>Utilization</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each residentSummary}}
                            <tr>
                                <td>
                                    <a href="/residents/{{id}}" class="text-decoration-none">
                                        {{first_name}} {{last_name}}
                                    </a>
                                </td>
                                <td>{{property_name}}</td>
                                <td>{{monthly_support_hours}}h</td>
                                <td>{{hours_used}}h</td>
                                <td>
                                    <span class="badge {{#if (gt utilization_percentage 80)}}bg-success{{else if (gt utilization_percentage 60)}}bg-warning{{else}}bg-danger{{/if}}">
                                        {{utilization_percentage}}%
                                    </span>
                                </td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Support Type Breakdown</h5>
            </div>
            <div class="card-body">
                <canvas id="supportTypeChart" width="400" height="300"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Property Performance</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Property</th>
                                <th>Residents</th>
                                <th>Total Hours</th>
                                <th>Sessions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each propertyStats}}
                            <tr>
                                <td>
                                    <a href="/properties/{{id}}" class="text-decoration-none">
                                        {{name}}
                                    </a>
                                </td>
                                <td>{{resident_count}} / {{max_capacity}}</td>
                                <td>{{total_hours}}h</td>
                                <td>{{total_sessions}}</td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Support Worker Performance</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Support Worker</th>
                                <th>Sessions</th>
                                <th>Hours</th>
                                <th>Utilization</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each workerStats}}
                            <tr>
                                <td>
                                    <a href="/support-workers/{{id}}" class="text-decoration-none">
                                        {{first_name}} {{last_name}}
                                    </a>
                                </td>
                                <td>{{total_sessions}}</td>
                                <td>{{total_hours}}h</td>
                                <td>
                                    <span class="badge {{#if (gt utilization_percentage 80)}}bg-success{{else if (gt utilization_percentage 60)}}bg-warning{{else}}bg-secondary{{/if}}">
                                        {{utilization_percentage}}%
                                    </span>
                                </td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Chart for support type breakdown
const ctx = document.getElementById('supportTypeChart').getContext('2d');
new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: [{{#each supportTypeBreakdown}}'{{label}}'{{#unless @last}},{{/unless}}{{/each}}],
        datasets: [{
            data: [{{#each supportTypeBreakdown}}{{hours}}{{#unless @last}},{{/unless}}{{/each}}],
            backgroundColor: [{{#each supportTypeBreakdown}}'{{color}}'{{#unless @last}},{{/unless}}{{/each}}]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});
</script>